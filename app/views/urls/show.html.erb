<p id="notice"><%= notice %></p>

<div class="page-header">
  <h1>URL Details<small> ( <%= link_to 'Edit', edit_url_path(@url) %> ) </small></h1>
</div>

<ol class="breadcrumb">
  <li><a href="/">Home</a></li>
  <li><%= link_to 'Urls', urls_path %></li>
  <li class="active">View: <%= @url.url %></li>
</ol>

<div class='container' style='margin:0px; padding:0px'>
  <div class='pull-left'>
    <h4><small>Status: </small> <%= @url.status %></h4>
    <h4><small>Internal links: </small> <%= @url.internal_links %></h4>
    <h4><small>External links: </small> <%= @url.external_links %></h4>
  </div>

  <div class='pull-right'>
    <div id="donutchart" style="width: 500px; height: 250px;"></div>
  </div>
</div>


<% @sites.each do |site| %>
    <% if @url.links.where(:site_id => site.id).length > 0 %>
        <div>
          <h3><%= site.code %><small> ( <%= site.domain %> ) </small></h3>
        </div>
        <table class='table table-striped table-hover'>
          <thead>
          <tr>
            <td>Url</td>
            <td>Anchor</td>
            <td>Status</td>
            <td>Affiliate</td>
            <td align='center'>Campaign</td>
            <td align='right' width=200>Last update</td>
          </tr>
          </thead>
          <tbody>
          <% @url.links.where(:site_id => site.id).each do |link| %>
              <tr>
                <td><%= link_to link.link, link.link %></td>
                <td><%= link.anchor %></td>
                <td><%= link.status %></td>
                <td><%= link.affiliate %></td>
                <td align='center'><%= link.campaign %></td>
                <td align='right'><%= link.updated_at %></td>
              </tr>
          <% end %>
          </tbody>
        </table>
    <% end %>
<% end %>


<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(drawChart);
    function drawChart() {
        var data = google.visualization.arrayToDataTable([
            ['Link Type', 'number'],
            ['Internal links', <%= @url.internal_links %>],
            ['External links', <%= @url.external_links %>]
        ]);

        var options = {
            title: 'Internal vs External links',
            pieHole: 0.4,
        };

        var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
        chart.draw(data, options);
    }
</script>


